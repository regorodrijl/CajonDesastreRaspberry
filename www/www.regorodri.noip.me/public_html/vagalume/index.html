<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Vagalume</title>

	<script src="js/jquery.js" type="text/javascript"></script>
	<style type="text/css">
		body{
			text-align: center;
		}
		table{
			border-collapse: collapse;
		}
	</style>
</head>
<body>
	<h2>Vagalume</h2>
	<table border="1">
		<tr>
			<td>p1</td>
			<td>p2</td>
			<td>p3</td>
		</tr>
	</table>
	<table align="center">
		<thead>
			<tr>
				<td rowspan="2"></td>	
				<td style="border: 1px solid " colspan="2">P1</td>
				<td style="border: 1px solid " colspan="2">P2</td>
				<td style="border: 1px solid " colspan="2">P3</td>
			</tr>
			<tr>
				<td style="border: 1px solid">PMAX</td>
				<td style="border: 1px solid">Pfact</td>
				<td style="border: 1px solid">PMAX</td>
				<td style="border: 1px solid">Pfact</td>
				<td style="border: 1px solid">PMAX</td>
				<td style="border: 1px solid">Pfact</td>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>mes 1</td>
				<td style="border: 1px solid"><input id="m1p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m1p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m1p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m1p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m1p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m1p3pf" size="10" type="number" readonly/></td>
			</tr>
			<tr>
				<td>mes 2</td>
				<td style="border: 1px solid"><input id="m2p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m2p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m2p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m2p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m2p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m2p3pf" size="10" type="number" readonly/></td>

			</tr>
			<tr>
				<td>mes	3</td>
				<td style="border: 1px solid"><input id="m3p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m3p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m3p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m3p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m3p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m3p3pf" size="10" type="number" readonly/></td>

			</tr>
			<tr>
				<td>mes 4</td>
				<td style="border: 1px solid"><input id="m4p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m4p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m4p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m4p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m4p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m4p3pf" size="10" type="number" readonly/></td>
			</tr>
			<tr>
				<td>mes 5</td>				
				<td style="border: 1px solid"><input id="m5p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m5p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m5p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m5p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m5p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m5p3pf" size="10" type="number" readonly/></td>
				
			</tr>
			<tr>
				<td>mes 6</td>
				<td style="border: 1px solid"><input id="m6p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m6p1pm" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m6p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m6p1pm" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m6p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m6p1pm" size="10" type="number" readonly/></td>
				
			</tr>
			<tr>
				<td>mes 7</td>
				<td style="border: 1px solid"><input id="m7p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m7p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m7p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m7p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m7p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m7p3pf" size="10" type="number" readonly/></td>
			</tr>
			<tr>
				<td>mes 8</td>
				<td style="border: 1px solid"><input id="m8p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m8p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m8p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m8p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m8p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m8p3pf" size="10" type="number" readonly/></td>

			</tr>
			<tr>
				<td>mes 9</td>
				<td style="border: 1px solid"><input id="m9p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m9p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m9p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m9p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m9p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m9p3pf" size="10" type="number" readonly/></td>

			</tr>
			<tr>
				<td>mes 10</td>
				<td style="border: 1px solid"><input id="m10p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m10p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m10p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m10p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m10p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m10p3pf" size="10" type="number" readonly/></td>

			</tr>
			<tr>
				<td>mes 11</td>
				<td style="border: 1px solid"><input id="m11p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m11p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m11p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m11p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m11p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m11p3pf" size="10" type="number" readonly/></td>

			</tr>
			<tr>
				<td>mes 12</td>
				<td style="border: 1px solid"><input id="m12p1pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m12p1pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m12p2pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m12p2pf" size="10" type="number" readonly/></td>
				<td style="border: 1px solid"><input id="m12p3pm" size="10" type="number"/></td>
				<td style="border: 1px solid"><input id="m12p3pf" size="10" type="number" readonly/></td>

			</tr>
			<tr>
				<td rowspan="2">TOTAL</td>
				<td>kw</td>
				<td style="border: 1px solid"><input id="p1pmax" size="10" type="number"/></td>
				<td>kw</td>
				<td style="border: 1px solid"><input id="p1pmax" size="10" type="number"/></td>
				<td>kw</td>
				<td style="border: 1px solid"><input id="p1pmax" size="10" type="number"/></td>
			</tr>
			<tr>

				<td>€</td>
				<td style="border: 1px solid"><input id="p1pmax" size="10" type="number"/></td>
				<td>€</td>
				<td style="border: 1px solid"><input id="p1pmax" size="10" type="number"/></td>
				<td>€</td>
				<td style="border: 1px solid"><input id="p1pmax" size="10" type="number"/></td>
			</tr>
		</tbody>
	</table>
	<hr>
	<button type="button" id="calcular" >Calcular</button>
	<button type="button" class="btn btn-default">Guardar</button>
</body>
<script>
	$(document).ready(function() {
		$("#calcular").click(function () {
			var expresion =/^[0-9]+(\.[0-9]+)?$/;

			var m1p1pm = $("#m1p1pm").val();
			var m2p1pm = $("#m2p1pm").val();
			var m3p1pm = $("#m3p1pm").val();
			var m4p1pm = $("#m4p1pm").val();
			var m5p1pm = $("#m5p1pm").val();
			var m6p1pm = $("#m6p1pm").val();
			var m7p1pm = $("#m7p1pm").val();
			var m8p1pm = $("#m8p1pm").val();
			var m9p1pm = $("#m9p1pm").val();
			var m10p1pm = $("#m10p1pm").val();
			var m11p1pm = $("#m11p1pm").val();
			var m12p1pm = $("#m12p1pm").val();

			var arrayP1=[];
			if (expresion.test(m1p1pm) && expresion.test(m2p1pm) && expresion.test(m3p1pm) && expresion.test(m4p1pm) && expresion.test(m5p1pm) && expresion.test(m6p1pm) && expresion.test(m7p1pm) && expresion.test(m8p1pm) && expresion.test(m9p1pm) && expresion.test(m10p1pm) && expresion.test(m11p1pm) && expresion.test(m12p1pm)) {
				arrayP1.push(m1p1pm,m2p1pm,m3p1pm,m4p1pm,m5p1pm,m6p1pm,m7p1pm,m8p1pm,m9p1pm,m10p1pm,m11p1pm,m12p1pm);
				// los ordeno de menor a mayor
				arrayP1.sort(function(a, b){return a-b});

				var arrayPF=[];
				var objPF={};
				var min=Math.min.apply(null, arrayP1);
				var max=Math.max.apply(null, arrayP1);
				// del min. al max. de Pm.
				for (var i=min; i <= max;i+=0.01){
					i=i.toFixed(2);
					i=parseFloat(i);// problemas con la inexactitud de float

					var Pc85=i*0.85;
					Pc85=parseFloat(Pc85);
					var Pc105=i*1.05;
					Pc105=parseFloat(Pc105);
					var Pc=i;
					Pc=parseFloat(Pc);

					
					//console.log(Pc85,Pc105,Pc);
					// para cada Pm
					$.each(arrayP1,function(k,v){
						var Pm=parseFloat(v);
						var pf;
						// Comprobamos para guardar para ese valor de pm el pf y luego compararlo.
						if(Pm <= Pc85){
							pf=Pc85;
						}else if(Pc85 < Pm && Pm <= Pc105){
							pf=Pm;
						}else if(Pm > Pc105){
							console.log("antes del claculo los datos son: "+Pm+ " PC.105 "+Pc105);
							pf= Pm+((Pm-Pc105)*(Pm-Pc105));
							console.log("Calculo "+pf);
						}
						objPF.pm=v;
						objPF.pf=pf;
						arrayPF.push(pf);
					});
					
					console.log(i);
				}

				console.log("numero valido",arrayP1);
				console.log("ARRAY pf",arrayPF);
				console.log("OBJ pf ",objPF);
				
			}else{
				console.log("Falta algún dato");
			}
		});
	});
</script>
</html>